<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>前端文件上传 | Erun&#39;s Blog</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/blog-solid.ico">
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/assets/css/0.styles.64f7ac41.css" as="style"><link rel="preload" href="/assets/js/app.046e486f.js" as="script"><link rel="preload" href="/assets/js/2.cb9b70d5.js" as="script"><link rel="preload" href="/assets/js/5.15d4190c.js" as="script"><link rel="prefetch" href="/assets/js/10.65033b73.js"><link rel="prefetch" href="/assets/js/11.dc480957.js"><link rel="prefetch" href="/assets/js/12.dc9b98bc.js"><link rel="prefetch" href="/assets/js/13.20427e1b.js"><link rel="prefetch" href="/assets/js/14.c7574273.js"><link rel="prefetch" href="/assets/js/15.c9f6396d.js"><link rel="prefetch" href="/assets/js/16.dd8e599b.js"><link rel="prefetch" href="/assets/js/3.060301bd.js"><link rel="prefetch" href="/assets/js/4.d3a55895.js"><link rel="prefetch" href="/assets/js/6.18bcac4b.js"><link rel="prefetch" href="/assets/js/7.99688cf1.js"><link rel="prefetch" href="/assets/js/8.4e9db8b3.js"><link rel="prefetch" href="/assets/js/9.4450ef0b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.64f7ac41.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo2.png" alt="Erun's Blog" class="logo"> <span class="site-name can-hide">Erun's Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Blogs" class="dropdown-title"><span class="title">Blogs</span> <span class="arrow down"></span></button> <button type="button" aria-label="Blogs" class="mobile-dropdown-title"><span class="title">Blogs</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blogs_ES6/Promise浅析.html" class="nav-link">
  ES6
</a></li><li class="dropdown-item"><!----> <a href="/blogs_network/tcp.html" class="nav-link">
  网络
</a></li><li class="dropdown-item"><!----> <a href="/blogs_works/uploadFile.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  业务相关
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/erun808" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Blogs" class="dropdown-title"><span class="title">Blogs</span> <span class="arrow down"></span></button> <button type="button" aria-label="Blogs" class="mobile-dropdown-title"><span class="title">Blogs</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blogs_ES6/Promise浅析.html" class="nav-link">
  ES6
</a></li><li class="dropdown-item"><!----> <a href="/blogs_network/tcp.html" class="nav-link">
  网络
</a></li><li class="dropdown-item"><!----> <a href="/blogs_works/uploadFile.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  业务相关
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/erun808" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>探究业务功能实现的原理</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blogs_works/uploadFile.html" aria-current="page" class="active sidebar-link">前端文件上传</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blogs_works/historyAPI.html" class="sidebar-link">H5使用History API实现页面拦截</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="前端文件上传"><a href="#前端文件上传" class="header-anchor">#</a> 前端文件上传</h1> <h3 id="_1、原始上传方式"><a href="#_1、原始上传方式" class="header-anchor">#</a> 1、原始上传方式</h3> <p>W3C的规范中没有提供直接打开文件选择器的接口，必须由浏览器用户手动点击 <kbd><strong>按钮</strong></kbd> 触发，这是出于安全考虑，防止恶意网站未经用户同意就读取其本地的文件信息。那么这个 <kbd><strong>按钮</strong></kbd> 就是 <strong><code>&lt;input type=&quot;file&quot;&gt;</code></strong>，点击这个按钮可以调出操作系统的文件选择器，选择文件点击确定后可以拿到关于文件的<strong>信息</strong>，然后通过表单提交的形式上传到后台，这是目前前端（主要是Web端）处理文件上传的原始方法，看起来好像很简单，其实里面有一些细节需要注意。首先看一下实现这一功能的示例代码：</p> <div class="language-html extra-class"><pre class="language-html"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>multipart/form-data<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>提交<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>以上代码中表单的属性 <code>action</code> 要填写在提交表单时要跳转的后端页面地址，<code>enctype</code> 属性要设置为 <code>multipart/form-data</code>（这是设置请求头中的 <code>content-type</code> 字段，以便后台识别传输的数据类型），这样一段代码就可以实现简单的文件的上传功能。当然这种方法的缺点也很多，它基本只在前后端不分离（前端页面由后台驱动）的开发模式中使用，每次提交表单后都会刷新并跳转页面，显然在目前前后端分离的流行趋势下，特别是使用了 <code>Vue</code>、<code>React</code>等前端框架进行开发时基本不会用到这种原始方法。</p> <h3 id="_2、探究文件信息"><a href="#_2、探究文件信息" class="header-anchor">#</a> 2、探究文件信息</h3> <p>虽然原始的文件上传方法不经常使用，但从根本出发还是有一些疑惑需要解决，比如上面提到的关于文件的<strong>信息</strong>到底是什么，文件不同于文本数据让人容易理解，如果表单中只是包含文本信息，那我们能很确定的知道传输到后台的数据是什么，但是一个文件它有文件名、文件大小等信息，还有最关键的文件内容，到底传输给后台的文件包含了哪些信息呢？通过一段代码来看一下：</p> <div class="language-js extra-class"><pre class="language-js"><code>    window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 获取上面html代码中的文件上传按钮的DOM节点</span>
        <span class="token keyword">let</span> files <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#file&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        files<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'change'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>files<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 2种写法相同</span>
            <span class="token comment">// console.log(files.files);</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>上面的代码会在选择文件之后打印出关于文件的信息，可以注意到 <code>e.target</code> 指向的就是那个选择文件的按钮，上传到后台的文件信息就存储在其 <code>files</code> 属性中，这里我们选择一张图片进行测试，以下是打印结果：</p> <p><img src="/assets/img/file_log.40ce4a14.png" alt="文件信息"></p> <p>可以看到 <code>files</code> 属性是一个数组类型，其中的每个元素是 <code>File</code> 对象的实例，绿色框标出来的内容就包含了文件的名称、类型、大小等信息，但是其文件内容却是不可见的，下面是MDN中对 <code>File</code> 对象来源的描述：</p> <blockquote><p>通常情况下， File 对象是来自用户在一个 <code>&lt;input&gt;</code> 元素上选择文件后返回的 FileList 对象,也可以是来自由拖放操作生成的 DataTransfer 对象，或者来自 HTMLCanvasElement 上的 mozGetAsFile() API。</p></blockquote> <p>当然也可以通过 <code>new</code> 关键字创建一个 <code>File</code> 实例。那么到目前为止，我们知道用原始的表单提交方式上传的文件是一个 <code>File</code> 对象的实例，但是关于为什么 <code>File</code> 实例的文件内容不可见，以及这个 <code>File</code> 实例传输到后台时后台是怎样解析的等问题，还有待进一步研究。对于 <code>File</code> 对象的更多信息可以查阅<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/File" target="_blank" rel="noopener noreferrer">MDN的文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h3 id="_3、主流文件上传方式"><a href="#_3、主流文件上传方式" class="header-anchor">#</a> 3、主流文件上传方式</h3> <p>目前前后端分离的开发模式下的数据交换离不开 <code>Ajax</code> 的加持(当然现在也有新增的 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API" target="_blank" rel="noopener noreferrer"><code>Fetch API</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>)，基于 <code>Ajax</code> 封装的请求库也是有很多，比较经常使用的是 <code>Axios</code>。在这种异步请求和局部刷新页面的模式下，对于文件的上传通常是使用 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/FormData" target="_blank" rel="noopener noreferrer"><code>FormData</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 对象来完成的。简单示例代码如下：</p> <div class="language-js extra-class"><pre class="language-js"><code>   <span class="token comment">// 获取上面html代码中的文件上传按钮的DOM节点</span>
   <span class="token keyword">let</span> files <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#file&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">// 创建FormData对象</span>
   <span class="token keyword">let</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'fileName'</span><span class="token punctuation">,</span>files<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
   <span class="token comment">// 然后将formData作为参数通过接口传递给后台就行了</span>
</code></pre></div><p>上面的代码展示了如何通过 <code>FormData</code> 对象的 <code>append()</code> 方法追加一个属性来存储文件信息，然后就可以通过 <code>Ajax</code> 将文件信息传递给后台，不过应该注意的是追加的文件依然是一个 <code>File</code> 实例，依然来自 <code>&lt;input type=&quot;file&quot;&gt;</code> 这个按钮的 <code>files</code> 属性中。
在这里针对图片上传有一个常见的需求，是要求在图片上传时能在前端预览，这时就要用到 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/FileReader" target="_blank" rel="noopener noreferrer"><code>FileReader</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 对象了，简单示例代码如下：</p> <div class="language-html extra-class"><pre class="language-html"><code>   <span class="token comment">&lt;!-- 初始src是占位图 --&gt;</span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token style-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token style language-css"><span class="token property">height</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>img<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://www.wenjiangs.com/wp-content/uploads/2019/04/350x200.png<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>   window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">let</span> files <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#file&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">let</span> img <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#img'</span><span class="token punctuation">)</span>
       <span class="token keyword">let</span> fileReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       files<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'change'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
           <span class="token comment">// 需要将File对象转换为Blob对象</span>
           <span class="token keyword">let</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span>files<span class="token punctuation">.</span>files<span class="token punctuation">,</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> files<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>type <span class="token punctuation">}</span><span class="token punctuation">)</span>
           <span class="token comment">// 将blob数据进行base64编码</span>
           fileReader<span class="token punctuation">.</span><span class="token function">readAsDataURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span>
           fileReader<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token comment">// 将得到的base64数据替换&lt;img&gt;标签的src属性就能实现预览</span>
               img<span class="token punctuation">.</span>src <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
       <span class="token punctuation">}</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>    
</code></pre></div><p>上面的代码使用了 <code>FileReader</code> 对象的 <code>readAsDataURL()</code> 方法将图片信息（Blob类型）进行base64编码，得到的结果可以直接替换 <code>&lt;img&gt;</code> 标签的 <code>src</code> 属性。<code>Blob</code> 对象是 <code>File</code> 对象的超类，更多信息请见<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Blob" target="_blank" rel="noopener noreferrer">MDN文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。上面代码的测试结果如下:
<img src="/assets/img/before_upload.b7df80b2.jpg" alt="上传前占位图"> <img src="/assets/img/after_upload.16dfbcfe.jpg" alt="上传后预览图"></p> <h3 id="_4、小程序文件上传"><a href="#_4、小程序文件上传" class="header-anchor">#</a> 4、小程序文件上传</h3> <p>接触到小程序开发后（主要是微信小程序和支付宝小程序），发现在小程序中所有浏览器的 <code>API</code> 都不能使用，只能用小程序提供的 <code>API</code>，所以小程序自然是不支持 <code>FormData</code> 对象的，也不能对 <code>&lt;input&gt;</code> 标签设置 <code>type=&quot;file&quot;</code>，但它们有自己的接口解决文件上传的问题，以微信小程序为例，它提供了 <code>wx.chooseMessageFile()</code>来从客户端会话（微信的会话）中选择文件，还有专门的图片选择接口 <code>wx.chooseImage()</code>来调出手机的相册或者进行拍照，而<code>wx.uploadFile()</code> 接口则是实现将选择的文件进行上传的功能，图片上传的官方示例代码如下：</p> <div class="language-js extra-class"><pre class="language-js"><code>    wx<span class="token punctuation">.</span><span class="token function">chooseImage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token function">success</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> tempFilePaths <span class="token operator">=</span> res<span class="token punctuation">.</span>tempFilePaths
            wx<span class="token punctuation">.</span><span class="token function">uploadFile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                url<span class="token operator">:</span> <span class="token string">'https://example.weixin.qq.com/upload'</span><span class="token punctuation">,</span> <span class="token comment">//仅为示例，非真实的接口地址</span>
                filePath<span class="token operator">:</span> tempFilePaths<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 这里在传输时会根据文件的临时地址将文件信息转成file类型</span>
                name<span class="token operator">:</span> <span class="token string">'file'</span><span class="token punctuation">,</span>
                formData<span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token string">'user'</span><span class="token operator">:</span> <span class="token string">'test'</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token function">success</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token keyword">const</span> data <span class="token operator">=</span> res<span class="token punctuation">.</span>data
                    <span class="token comment">//do something</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>上面代码中选择图片的成功回调参数包含图片的信息，其中 <code>tempFilePaths</code> 属性是保存了所选图片的临时地址的数组（可以设置选择多张图片），至于图片的预览小程序也有封装好的接口： <code>wx.previewImage()</code>，可以看到小程序对于文件的操作进行了很好的封装，微信小程序的<code>API</code>中甚至有一整个关于文件操作的  模块。更多信息请见<a href="https://developers.weixin.qq.com/miniprogram/dev/api/" target="_blank" rel="noopener noreferrer">微信开发者文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/blogs_works/historyAPI.html">
        H5使用History API实现页面拦截
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.046e486f.js" defer></script><script src="/assets/js/2.cb9b70d5.js" defer></script><script src="/assets/js/5.15d4190c.js" defer></script>
  </body>
</html>
